<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IQ Test Pro</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap');

  :root {
    --primary: #6c63ff;
    --secondary: #ff6584;
    --accent: #43e97b;
    --dark: #0a0a1a;
    --card: #12122a;
    --card2: #1a1a35;
    --text: #e0e0ff;
    --gold: #ffd700;
    --silver: #c0c0c0;
    --bronze: #cd7f32;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Exo 2', sans-serif;
    background: var(--dark);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* PARTICLES */
  #particles {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  .particle {
    position: absolute;
    border-radius: 50%;
    animation: float linear infinite;
  }

  @keyframes float {
    0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { transform: translateY(-100px) rotate(720deg); opacity: 0; }
  }

  /* SCREENS */
  .screen {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .screen.active { display: flex; }

  /* LANGUAGE SCREEN */
  #lang-screen {
    background: radial-gradient(ellipse at center, #1a1a3e 0%, #0a0a1a 70%);
  }

  .lang-title {
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(2rem, 5vw, 4rem);
    font-weight: 900;
    text-align: center;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #6c63ff, #ff6584, #43e97b);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: titleGlow 3s ease-in-out infinite;
  }

  @keyframes titleGlow {
    0%, 100% { filter: drop-shadow(0 0 20px rgba(108,99,255,0.8)); }
    50% { filter: drop-shadow(0 0 40px rgba(255,101,132,0.8)); }
  }

  .lang-subtitle {
    text-align: center;
    color: #888;
    margin-bottom: 50px;
    font-size: 1rem;
    letter-spacing: 3px;
    text-transform: uppercase;
  }

  .lang-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    max-width: 600px;
    width: 100%;
  }

  .lang-btn {
    background: var(--card);
    border: 2px solid rgba(108,99,255,0.3);
    border-radius: 20px;
    padding: 30px 20px;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .lang-btn::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(108,99,255,0.2), transparent);
    transition: left 0.5s;
  }

  .lang-btn:hover::before { left: 100%; }

  .lang-btn:hover {
    border-color: var(--primary);
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(108,99,255,0.3);
  }

  .lang-flag { font-size: 3rem; display: block; margin-bottom: 10px; }
  .lang-name { font-size: 1.2rem; font-weight: 700; color: var(--text); }
  .lang-native { font-size: 0.85rem; color: #888; margin-top: 5px; }

  /* INTRO SCREEN */
  #intro-screen {
    background: radial-gradient(ellipse at center, #1a1a3e 0%, #0a0a1a 70%);
    text-align: center;
  }

  .brain-icon {
    font-size: 6rem;
    margin-bottom: 20px;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }

  .intro-title {
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(2.5rem, 6vw, 5rem);
    font-weight: 900;
    background: linear-gradient(135deg, #6c63ff, #ff6584);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 15px;
  }

  .intro-desc {
    color: #aaa;
    max-width: 500px;
    line-height: 1.7;
    font-size: 1rem;
    margin-bottom: 40px;
  }

  .stats-row {
    display: flex;
    gap: 30px;
    margin-bottom: 40px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .stat-box {
    background: var(--card);
    border: 1px solid rgba(108,99,255,0.3);
    border-radius: 15px;
    padding: 15px 25px;
    text-align: center;
  }

  .stat-num {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8rem;
    font-weight: 900;
    color: var(--accent);
  }

  .stat-label { font-size: 0.8rem; color: #666; margin-top: 5px; }

  .start-btn {
    background: linear-gradient(135deg, var(--primary), #8b5cf6);
    border: none;
    border-radius: 50px;
    padding: 18px 60px;
    font-size: 1.2rem;
    font-weight: 700;
    color: white;
    cursor: pointer;
    font-family: 'Exo 2', sans-serif;
    letter-spacing: 2px;
    text-transform: uppercase;
    transition: all 0.3s;
    box-shadow: 0 10px 30px rgba(108,99,255,0.5);
    position: relative;
    overflow: hidden;
  }

  .start-btn::before {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    width: 0; height: 0;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  .start-btn:hover::before { width: 300px; height: 300px; }
  .start-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 40px rgba(108,99,255,0.6);
  }

  /* GAME SCREEN */
  #game-screen {
    background: radial-gradient(ellipse at center, #0f0f2a 0%, #0a0a1a 70%);
    padding: 20px;
  }

  .game-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: 800px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
  }

  .progress-info {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.85rem;
    color: var(--primary);
    letter-spacing: 2px;
  }

  .timer-box {
    background: var(--card);
    border: 2px solid var(--secondary);
    border-radius: 12px;
    padding: 8px 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .timer-icon { font-size: 1.2rem; }

  .timer-val {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--secondary);
    min-width: 30px;
    text-align: center;
    transition: color 0.3s;
  }

  .timer-val.urgent { color: #ff4444; animation: blink 0.5s ease infinite; }
  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

  .score-box {
    background: var(--card);
    border: 2px solid var(--accent);
    border-radius: 12px;
    padding: 8px 20px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    color: var(--accent);
  }

  .progress-bar-wrap {
    width: 100%;
    max-width: 800px;
    height: 6px;
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
    margin-bottom: 25px;
    overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    border-radius: 3px;
    transition: width 0.5s ease;
  }

  .category-badge {
    background: linear-gradient(135deg, rgba(108,99,255,0.2), rgba(255,101,132,0.2));
    border: 1px solid rgba(108,99,255,0.4);
    border-radius: 20px;
    padding: 6px 18px;
    font-size: 0.8rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #aaa;
    margin-bottom: 20px;
  }

  .question-card {
    background: var(--card);
    border: 1px solid rgba(108,99,255,0.25);
    border-radius: 25px;
    padding: 35px;
    max-width: 800px;
    width: 100%;
    margin-bottom: 25px;
    position: relative;
    animation: slideIn 0.4s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .q-num {
    position: absolute;
    top: -12px; left: 25px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 10px;
    padding: 4px 14px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 2px;
  }

  .question-text {
    font-size: clamp(1rem, 2.5vw, 1.3rem);
    line-height: 1.7;
    color: var(--text);
    text-align: center;
    margin-bottom: 10px;
  }

  /* Pattern questions */
  .pattern-grid {
    display: grid;
    gap: 8px;
    justify-content: center;
    margin: 20px auto;
  }

  .pattern-cell {
    width: 65px;
    height: 65px;
    border-radius: 12px;
    border: 2px solid rgba(255,255,255,0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    background: var(--card2);
    transition: all 0.3s;
    position: relative;
  }

  .pattern-cell.empty {
    border: 3px dashed var(--primary);
    background: rgba(108,99,255,0.1);
    animation: emptyPulse 2s ease-in-out infinite;
  }

  @keyframes emptyPulse {
    0%, 100% { border-color: var(--primary); box-shadow: 0 0 10px rgba(108,99,255,0.3); }
    50% { border-color: var(--accent); box-shadow: 0 0 20px rgba(67,233,123,0.3); }
  }

  /* SEQUENCE */
  .sequence-row {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin: 20px 0;
    align-items: center;
  }

  .seq-item {
    width: 65px;
    height: 65px;
    background: var(--card2);
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--text);
    font-family: 'Orbitron', sans-serif;
  }

  .seq-item.unknown {
    border: 3px dashed var(--primary);
    background: rgba(108,99,255,0.1);
    color: var(--primary);
    font-size: 2rem;
    animation: emptyPulse 2s ease-in-out infinite;
  }

  .seq-arrow {
    color: #444;
    font-size: 1.5rem;
  }

  /* OPTIONS */
  .options-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    max-width: 800px;
    width: 100%;
  }

  .option-btn {
    background: var(--card);
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 16px;
    padding: 16px 20px;
    cursor: pointer;
    text-align: left;
    display: flex;
    align-items: center;
    gap: 14px;
    transition: all 0.25s;
    position: relative;
    overflow: hidden;
    color: var(--text);
    font-family: 'Exo 2', sans-serif;
    font-size: 1rem;
  }

  .option-btn::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(108,99,255,0.1), transparent);
    transition: left 0.4s;
  }

  .option-btn:hover::before { left: 100%; }

  .option-btn:hover:not(:disabled) {
    border-color: var(--primary);
    transform: translateX(5px);
    box-shadow: 0 5px 25px rgba(108,99,255,0.25);
  }

  .option-btn:disabled { cursor: not-allowed; }

  .opt-label {
    width: 32px; height: 32px;
    background: linear-gradient(135deg, var(--primary), #8b5cf6);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: 0.9rem;
    flex-shrink: 0;
  }

  .opt-text { flex: 1; line-height: 1.4; }

  .option-btn.correct {
    border-color: var(--accent) !important;
    background: rgba(67,233,123,0.15) !important;
    animation: correctPop 0.4s ease;
  }

  .option-btn.wrong {
    border-color: var(--secondary) !important;
    background: rgba(255,101,132,0.15) !important;
    animation: shake 0.4s ease;
  }

  @keyframes correctPop {
    0% { transform: scale(1); }
    50% { transform: scale(1.03); }
    100% { transform: scale(1); }
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-8px); }
    40%, 80% { transform: translateX(8px); }
  }

  .checkmark, .xmark {
    position: absolute;
    right: 15px;
    font-size: 1.3rem;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .option-btn.correct .checkmark,
  .option-btn.wrong .xmark { opacity: 1; }

  /* FEEDBACK */
  .feedback-bubble {
    max-width: 800px;
    width: 100%;
    padding: 14px 20px;
    border-radius: 14px;
    margin-top: 10px;
    font-size: 0.95rem;
    line-height: 1.5;
    display: none;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .feedback-bubble.correct-fb {
    display: block;
    background: rgba(67,233,123,0.1);
    border: 1px solid rgba(67,233,123,0.4);
    color: #43e97b;
  }

  .feedback-bubble.wrong-fb {
    display: block;
    background: rgba(255,101,132,0.1);
    border: 1px solid rgba(255,101,132,0.4);
    color: #ff6584;
  }

  .next-btn {
    background: linear-gradient(135deg, var(--primary), #8b5cf6);
    border: none;
    border-radius: 50px;
    padding: 14px 50px;
    color: white;
    font-family: 'Exo 2', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 20px;
    transition: all 0.3s;
    box-shadow: 0 8px 25px rgba(108,99,255,0.4);
    display: none;
  }

  .next-btn.show { display: block; }
  .next-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(108,99,255,0.5); }

  /* DIFFICULTY */
  .diff-bar {
    display: flex;
    gap: 4px;
    margin-bottom: 5px;
  }

  .diff-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: #333;
  }

  .diff-dot.filled { background: var(--gold); }

  /* RESULT SCREEN */
  #result-screen {
    background: radial-gradient(ellipse at center, #1a1a3e 0%, #0a0a1a 70%);
    text-align: center;
    padding: 30px 20px;
  }

  .result-card {
    background: var(--card);
    border: 1px solid rgba(108,99,255,0.3);
    border-radius: 30px;
    padding: 40px;
    max-width: 600px;
    width: 100%;
    position: relative;
    overflow: hidden;
  }

  .result-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
  }

  .iq-circle {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    margin: 0 auto 25px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    background: conic-gradient(var(--primary) var(--pct, 0%), transparent 0%);
    animation: circleGrow 1.5s ease-out;
  }

  @keyframes circleGrow {
    from { transform: scale(0) rotate(-90deg); }
    to { transform: scale(1) rotate(0deg); }
  }

  .iq-circle::after {
    content: '';
    position: absolute;
    width: 130px; height: 130px;
    border-radius: 50%;
    background: var(--card);
  }

  .iq-val {
    position: relative;
    z-index: 2;
    font-family: 'Orbitron', sans-serif;
    font-size: 2.5rem;
    font-weight: 900;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .iq-label-small {
    position: relative;
    z-index: 2;
    font-size: 0.7rem;
    color: #666;
    letter-spacing: 2px;
  }

  .iq-category {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--gold);
  }

  .iq-desc {
    color: #999;
    line-height: 1.6;
    margin-bottom: 25px;
    font-size: 0.95rem;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 25px;
  }

  .stat-item {
    background: var(--card2);
    border-radius: 15px;
    padding: 15px;
    text-align: center;
  }

  .stat-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--accent);
  }

  .stat-key { font-size: 0.75rem; color: #666; margin-top: 5px; }

  .score-breakdown {
    background: var(--card2);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 25px;
    text-align: left;
  }

  .breakdown-title {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: #666;
    margin-bottom: 15px;
  }

  .breakdown-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .br-label { font-size: 0.85rem; color: #aaa; width: 120px; flex-shrink: 0; }

  .br-bar-wrap {
    flex: 1;
    height: 8px;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
    overflow: hidden;
  }

  .br-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 1.5s ease;
  }

  .br-score { font-size: 0.8rem; color: #aaa; width: 40px; text-align: right; }

  .action-btns {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .retry-btn {
    background: linear-gradient(135deg, var(--primary), #8b5cf6);
    border: none; border-radius: 50px;
    padding: 14px 35px;
    color: white;
    font-family: 'Exo 2', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 8px 25px rgba(108,99,255,0.4);
  }

  .retry-btn:hover { transform: translateY(-3px); }

  .share-btn {
    background: transparent;
    border: 2px solid var(--accent);
    border-radius: 50px;
    padding: 14px 35px;
    color: var(--accent);
    font-family: 'Exo 2', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
  }

  .share-btn:hover { background: rgba(67,233,123,0.1); transform: translateY(-3px); }

  /* SOUND TOGGLE */
  .sound-toggle {
    position: fixed;
    top: 20px; right: 20px;
    z-index: 100;
    background: var(--card);
    border: 2px solid rgba(108,99,255,0.3);
    border-radius: 12px;
    padding: 10px 15px;
    cursor: pointer;
    font-size: 1.2rem;
    transition: all 0.3s;
    color: var(--text);
  }

  .sound-toggle:hover { border-color: var(--primary); }

  /* COMBO */
  .combo-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: linear-gradient(135deg, var(--gold), #ffa500);
    border-radius: 20px;
    padding: 20px 40px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5rem;
    font-weight: 900;
    color: var(--dark);
    z-index: 1000;
    pointer-events: none;
    transition: all 0.3s;
  }

  .combo-popup.show {
    transform: translate(-50%, -50%) scale(1);
    animation: comboAnim 1.5s ease forwards;
  }

  @keyframes comboAnim {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    40% { transform: translate(-50%, -50%) scale(1); }
    70% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -80%) scale(0.8); opacity: 0; }
  }

  /* Math display */
  .math-display {
    background: var(--card2);
    border-radius: 15px;
    padding: 20px;
    margin: 15px auto;
    max-width: 350px;
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(1.2rem, 4vw, 2rem);
    text-align: center;
    color: var(--accent);
    letter-spacing: 3px;
    border: 1px solid rgba(67,233,123,0.2);
  }

  /* Analogy */
  .analogy-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
    margin: 20px auto;
  }

  .analogy-word {
    background: var(--card2);
    border-radius: 12px;
    padding: 12px 20px;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text);
    border: 1px solid rgba(108,99,255,0.2);
  }

  .analogy-arrow {
    font-size: 1.5rem;
    color: #555;
  }

  .analogy-word.unknown {
    border: 2px dashed var(--primary);
    color: var(--primary);
    background: rgba(108,99,255,0.1);
    animation: emptyPulse 2s ease-in-out infinite;
  }

  /* Back button */
  .back-btn {
    position: fixed;
    top: 20px; left: 20px;
    z-index: 100;
    background: var(--card);
    border: 2px solid rgba(108,99,255,0.3);
    border-radius: 12px;
    padding: 10px 18px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s;
    color: var(--text);
    display: none;
  }

  .back-btn:hover { border-color: var(--primary); }
  .back-btn.show { display: block; }

  /* confetti */
  .confetti-piece {
    position: fixed;
    width: 10px;
    height: 10px;
    top: -10px;
    border-radius: 2px;
    animation: confettiFall linear forwards;
    z-index: 9999;
    pointer-events: none;
  }

  @keyframes confettiFall {
    0% { top: -10px; transform: rotate(0deg) translateX(0); opacity: 1; }
    100% { top: 100vh; transform: rotate(720deg) translateX(var(--tx, 50px)); opacity: 0; }
  }

  /* Responsive */
  @media (max-width: 480px) {
    .options-grid { grid-template-columns: 1fr; }
    .lang-grid { grid-template-columns: 1fr; max-width: 250px; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .question-card { padding: 25px 15px; }
    .result-card { padding: 25px 15px; }
  }
</style>
</head>
<body>

<!-- Particles -->
<canvas id="particles"></canvas>

<!-- Sound Toggle -->
<button class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</button>

<!-- Back Button -->
<button class="back-btn" id="backBtn" onclick="goBack()">‚Üê Back</button>

<!-- Combo Popup -->
<div class="combo-popup" id="comboPopup"></div>

<!-- ===== LANGUAGE SCREEN ===== -->
<div class="screen active" id="lang-screen">
  <div class="lang-title">üß† IQ TEST PRO</div>
  <div class="lang-subtitle">Select your language ¬∑ Tilni tanlang ¬∑ –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫</div>
  <div class="lang-grid">
    <div class="lang-btn" onclick="selectLang('uz')">
      <span class="lang-flag">üá∫üáø</span>
      <div class="lang-name">O'zbek</div>
      <div class="lang-native">O'zbek tili</div>
    </div>
    <div class="lang-btn" onclick="selectLang('ru')">
      <span class="lang-flag">üá∑üá∫</span>
      <div class="lang-name">–†—É—Å—Å–∫–∏–π</div>
      <div class="lang-native">Russian</div>
    </div>
    <div class="lang-btn" onclick="selectLang('en')">
      <span class="lang-flag">üá¨üáß</span>
      <div class="lang-name">English</div>
      <div class="lang-native">English</div>
    </div>
  </div>
</div>

<!-- ===== INTRO SCREEN ===== -->
<div class="screen" id="intro-screen">
  <div class="brain-icon">üß†</div>
  <div class="intro-title">IQ TEST PRO</div>
  <p class="intro-desc" id="intro-desc">Loading...</p>
  <div class="stats-row">
    <div class="stat-box">
      <div class="stat-num">25</div>
      <div class="stat-label" id="stat-q">Questions</div>
    </div>
    <div class="stat-box">
      <div class="stat-num">30s</div>
      <div class="stat-label" id="stat-t">Per question</div>
    </div>
    <div class="stat-box">
      <div class="stat-num">6</div>
      <div class="stat-label" id="stat-c">Categories</div>
    </div>
  </div>
  <button class="start-btn" id="startBtn" onclick="startGame()">‚ñ∂ START</button>
</div>

<!-- ===== GAME SCREEN ===== -->
<div class="screen" id="game-screen">
  <div class="game-header">
    <div class="progress-info" id="progressInfo">Q 1 / 25</div>
    <div class="timer-box">
      <span class="timer-icon">‚è±</span>
      <span class="timer-val" id="timerVal">30</span>
    </div>
    <div class="score-box" id="scoreBox">‚≠ê 0</div>
  </div>
  <div class="progress-bar-wrap">
    <div class="progress-bar-fill" id="progressBar" style="width:0%"></div>
  </div>
  <div class="category-badge" id="categoryBadge">Logic</div>
  <div class="question-card" id="questionCard">
    <div class="q-num" id="qNum">Q1</div>
    <div style="display:flex; gap:5px; margin-bottom:15px; justify-content:center;" id="diffBar"></div>
    <div class="question-text" id="questionText"></div>
    <div id="questionVisual"></div>
  </div>
  <div class="options-grid" id="optionsGrid"></div>
  <div class="feedback-bubble" id="feedbackBubble"></div>
  <button class="next-btn" id="nextBtn" onclick="nextQuestion()">NEXT ‚Üí</button>
</div>

<!-- ===== RESULT SCREEN ===== -->
<div class="screen" id="result-screen">
  <div class="result-card">
    <div class="iq-circle" id="iqCircle">
      <div class="iq-val" id="iqVal">--</div>
      <div class="iq-label-small">IQ</div>
    </div>
    <div class="iq-category" id="iqCategory">Loading...</div>
    <div class="iq-desc" id="iqDesc">Loading...</div>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value" id="resCorrect">0</div>
        <div class="stat-key" id="resCorrectLabel">Correct</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="resTime">0s</div>
        <div class="stat-key" id="resTimeLabel">Avg time</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="resScore">0</div>
        <div class="stat-key" id="resScoreLabel">Score</div>
      </div>
    </div>
    <div class="score-breakdown" id="scoreBreakdown">
      <div class="breakdown-title" id="bdTitle">Category breakdown</div>
    </div>
    <div class="action-btns">
      <button class="retry-btn" id="retryBtn" onclick="retry()">üîÑ Retry</button>
      <button class="share-btn" id="shareBtn" onclick="shareResult()">üì§ Share</button>
    </div>
  </div>
</div>

<script>
// ==================== AUDIO ENGINE ====================
const AudioContext = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
let soundEnabled = true;
let musicGain = null;
let bgMusicOsc = [];

function initAudio() {
  if (!audioCtx) {
    audioCtx = new AudioContext();
    startBGMusic();
  } else if (audioCtx.state === 'suspended') {
    audioCtx.resume();
    startBGMusic();
  }
}

function startBGMusic() {
  if (!soundEnabled) return;
  stopBGMusic();
  musicGain = audioCtx.createGain();
  musicGain.gain.setValueAtTime(0.08, audioCtx.currentTime);
  musicGain.connect(audioCtx.destination);

  const notes = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25];
  const pattern = [0, 4, 7, 4, 5, 2, 0, 5, 4, 7, 2, 5, 4, 0, 7, 4];
  let beatTime = audioCtx.currentTime;
  const tempo = 0.35;

  function scheduleBeat(idx) {
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.value = notes[pattern[idx % pattern.length]];
    g.gain.setValueAtTime(0, beatTime);
    g.gain.linearRampToValueAtTime(0.15, beatTime + 0.02);
    g.gain.linearRampToValueAtTime(0.05, beatTime + tempo * 0.6);
    g.gain.linearRampToValueAtTime(0, beatTime + tempo);
    osc.connect(g);
    g.connect(musicGain);
    osc.start(beatTime);
    osc.stop(beatTime + tempo);
    bgMusicOsc.push(osc);
    beatTime += tempo;
  }

  for (let i = 0; i < 64; i++) scheduleBeat(i);
  // Loop
  setTimeout(() => { if (soundEnabled) startBGMusic(); }, pattern.length * tempo * 1000 * 4);
}

function stopBGMusic() {
  bgMusicOsc.forEach(o => { try { o.stop(); } catch(e) {} });
  bgMusicOsc = [];
}

function playSound(type) {
  if (!soundEnabled || !audioCtx) return;
  const now = audioCtx.currentTime;
  const g = audioCtx.createGain();
  g.connect(audioCtx.destination);

  if (type === 'correct') {
    [523.25, 659.25, 783.99].forEach((freq, i) => {
      const o = audioCtx.createOscillator();
      o.type = 'triangle';
      o.frequency.value = freq;
      g.gain.setValueAtTime(0.3, now + i * 0.12);
      g.gain.linearRampToValueAtTime(0, now + i * 0.12 + 0.3);
      o.connect(g);
      o.start(now + i * 0.12);
      o.stop(now + i * 0.12 + 0.3);
    });
  } else if (type === 'wrong') {
    [220, 180].forEach((freq, i) => {
      const o = audioCtx.createOscillator();
      o.type = 'sawtooth';
      o.frequency.value = freq;
      const gg = audioCtx.createGain();
      gg.gain.setValueAtTime(0.2, now + i * 0.15);
      gg.gain.linearRampToValueAtTime(0, now + i * 0.15 + 0.3);
      o.connect(gg);
      gg.connect(audioCtx.destination);
      o.start(now + i * 0.15);
      o.stop(now + i * 0.15 + 0.3);
    });
  } else if (type === 'tick') {
    const o = audioCtx.createOscillator();
    o.type = 'square';
    o.frequency.value = 800;
    g.gain.setValueAtTime(0.05, now);
    g.gain.linearRampToValueAtTime(0, now + 0.05);
    o.connect(g);
    o.start(now);
    o.stop(now + 0.05);
  } else if (type === 'combo') {
    [523.25, 659.25, 783.99, 1046.5].forEach((freq, i) => {
      const o = audioCtx.createOscillator();
      o.type = 'sine';
      o.frequency.value = freq;
      const gg = audioCtx.createGain();
      gg.gain.setValueAtTime(0.25, now + i * 0.1);
      gg.gain.linearRampToValueAtTime(0, now + i * 0.1 + 0.4);
      o.connect(gg);
      gg.connect(audioCtx.destination);
      o.start(now + i * 0.1);
      o.stop(now + i * 0.1 + 0.4);
    });
  } else if (type === 'finish') {
    const fanfare = [523.25, 659.25, 783.99, 1046.5, 1318.51];
    fanfare.forEach((freq, i) => {
      const o = audioCtx.createOscillator();
      o.type = 'triangle';
      o.frequency.value = freq;
      const gg = audioCtx.createGain();
      gg.gain.setValueAtTime(0, now + i * 0.18);
      gg.gain.linearRampToValueAtTime(0.3, now + i * 0.18 + 0.05);
      gg.gain.linearRampToValueAtTime(0, now + i * 0.18 + 0.5);
      o.connect(gg);
      gg.connect(audioCtx.destination);
      o.start(now + i * 0.18);
      o.stop(now + i * 0.18 + 0.5);
    });
  } else if (type === 'click') {
    const o = audioCtx.createOscillator();
    o.type = 'sine';
    o.frequency.value = 600;
    g.gain.setValueAtTime(0.15, now);
    g.gain.linearRampToValueAtTime(0, now + 0.08);
    o.connect(g);
    o.start(now);
    o.stop(now + 0.08);
  }
}

function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
  if (!soundEnabled) {
    stopBGMusic();
    if (musicGain) { musicGain.gain.setValueAtTime(0, audioCtx.currentTime); }
  } else if (audioCtx) {
    startBGMusic();
  }
}

// ==================== PARTICLES ====================
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let particlesArr = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

class Particle {
  constructor() { this.reset(); }
  reset() {
    this.x = Math.random() * canvas.width;
    this.y = canvas.height + 10;
    this.size = Math.random() * 3 + 1;
    this.speedY = -(Math.random() * 1 + 0.3);
    this.speedX = (Math.random() - 0.5) * 0.5;
    this.opacity = 0;
    this.maxOpacity = Math.random() * 0.5 + 0.1;
    this.color = ['#6c63ff', '#ff6584', '#43e97b', '#ffd700'][Math.floor(Math.random() * 4)];
    this.rotation = Math.random() * Math.PI * 2;
    this.rotSpeed = (Math.random() - 0.5) * 0.02;
  }
  update() {
    this.y += this.speedY;
    this.x += this.speedX;
    this.rotation += this.rotSpeed;
    if (this.y > canvas.height * 0.7) {
      this.opacity = Math.min(this.maxOpacity, this.opacity + 0.01);
    } else if (this.y < canvas.height * 0.3) {
      this.opacity -= 0.01;
    }
    if (this.opacity < 0 || this.y < -10) this.reset();
  }
  draw() {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);
    ctx.globalAlpha = this.opacity;
    ctx.fillStyle = this.color;
    ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
    ctx.restore();
  }
}

for (let i = 0; i < 60; i++) {
  const p = new Particle();
  p.y = Math.random() * canvas.height;
  particlesArr.push(p);
}

function animateParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particlesArr.forEach(p => { p.update(); p.draw(); });
  requestAnimationFrame(animateParticles);
}
animateParticles();

// ==================== LANGUAGE DATA ====================
const lang = {
  uz: {
    intro_desc: "Ushbu professional IQ testi sizning mantiqiy fikrlash, matematik qobiliyat, fazoviy idrok va nutqiy zehn darajangizni o'lchaydi.",
    stat_q: "Savollar",
    stat_t: "Har bir savol",
    stat_c: "Kategoriyalar",
    start: "‚ñ∂ BOSHLASH",
    categories: { logic: "Mantiq", math: "Matematika", spatial: "Fazoviy", verbal: "So'z", memory: "Xotira", pattern: "Naqsh" },
    correct_msg: "‚úÖ To'g'ri javob!",
    wrong_prefix: "‚ùå Noto'g'ri. To'g'ri javob:",
    next: "KEYINGISI ‚Üí",
    result_title: "Natijangiz",
    correct_label: "To'g'ri",
    time_label: "O'rtacha vaqt",
    score_label: "Ball",
    bd_title: "Kategoriyalar bo'yicha",
    retry: "üîÑ Qayta urinish",
    share: "üì§ Ulashish",
    iq_levels: [
      { min: 0, max: 70, label: "Past daraja", desc: "Mashq qilish va o'qish orqali yaxshilanishi mumkin.", color: "#ff6584" },
      { min: 70, max: 90, label: "O'rtachadan past", desc: "Ba'zi sohalarda qo'shimcha mashq talab etiladi.", color: "#ffa500" },
      { min: 90, max: 110, label: "O'rtacha daraja", desc: "Ko'pchilik odamlar bu oraliqda joylashadi.", color: "#ffd700" },
      { min: 110, max: 125, label: "Yuqori daraja", desc: "Aqliy qobiliyat o'rtachadan yuqori.", color: "#43e97b" },
      { min: 125, max: 140, label: "Iqtidorli", desc: "Siz iqtidorli insonlar qatoriga kirasiz!", color: "#6c63ff" },
      { min: 140, max: 200, label: "Daho darajasi", desc: "Fenomenal intellektual qobiliyat! Siz dahosiz!", color: "#ff6584" }
    ],
    combo: ["AJOYIB! +", "DAHO! +", "FENOMENAL! +"],
    timeout: "Vaqt tugadi!",
    share_text: (iq, score) => `Men IQ Test Pro'da ${iq} IQ ball to'pladim! Ball: ${score}. Siz ham sinab ko'ring!`
  },
  ru: {
    intro_desc: "–≠—Ç–æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π IQ-—Ç–µ—Å—Ç –∏–∑–º–µ—Ä—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –≤–∞—à–µ–≥–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è, –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π, –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –∏ –≤–µ—Ä–±–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.",
    stat_q: "–í–æ–ø—Ä–æ—Å–æ–≤",
    stat_t: "–ù–∞ –∫–∞–∂–¥—ã–π",
    stat_c: "–ö–∞—Ç–µ–≥–æ—Ä–∏–π",
    start: "‚ñ∂ –ù–ê–ß–ê–¢–¨",
    categories: { logic: "–õ–æ–≥–∏–∫–∞", math: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", spatial: "–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ", verbal: "–°–ª–æ–≤–µ—Å–Ω—ã–π", memory: "–ü–∞–º—è—Ç—å", pattern: "–ü–∞—Ç—Ç–µ—Ä–Ω" },
    correct_msg: "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç!",
    wrong_prefix: "‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:",
    next: "–î–ê–õ–ï–ï ‚Üí",
    result_title: "–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
    correct_label: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ",
    time_label: "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è",
    score_label: "–û—á–∫–∏",
    bd_title: "–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",
    retry: "üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å",
    share: "üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
    iq_levels: [
      { min: 0, max: 70, label: "–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å", desc: "–ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —Å –ø–æ–º–æ—â—å—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.", color: "#ff6584" },
      { min: 70, max: 90, label: "–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ", desc: "–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞.", color: "#ffa500" },
      { min: 90, max: 110, label: "–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å", desc: "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.", color: "#ffd700" },
      { min: 110, max: 125, label: "–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ", desc: "–£–º—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ.", color: "#43e97b" },
      { min: 125, max: 140, label: "–û–¥–∞—Ä—ë–Ω–Ω—ã–π", desc: "–í—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ —á–∏—Å–ª—É –æ–¥–∞—Ä—ë–Ω–Ω—ã—Ö –ª—é–¥–µ–π!", color: "#6c63ff" },
      { min: 140, max: 200, label: "–£—Ä–æ–≤–µ–Ω—å –≥–µ–Ω–∏—è", desc: "–§–µ–Ω–æ–º–µ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç! –í—ã –≥–µ–Ω–∏–π!", color: "#ff6584" }
    ],
    combo: ["–û–¢–õ–ò–ß–ù–û! +", "–ì–ï–ù–ò–ô! +", "–§–ï–ù–û–ú–ï–ù–ê–õ–¨–ù–û! +"],
    timeout: "–í—Ä–µ–º—è –≤—ã—à–ª–æ!",
    share_text: (iq, score) => `–Ø –Ω–∞–±—Ä–∞–ª ${iq} IQ –±–∞–ª–ª–æ–≤ –≤ IQ Test Pro! –°—á—ë—Ç: ${score}. –ü–æ–ø—Ä–æ–±—É–π –∏ —Ç—ã!`
  },
  en: {
    intro_desc: "This professional IQ test measures your logical reasoning, mathematical ability, spatial perception, and verbal intelligence levels.",
    stat_q: "Questions",
    stat_t: "Per question",
    stat_c: "Categories",
    start: "‚ñ∂ START",
    categories: { logic: "Logic", math: "Math", spatial: "Spatial", verbal: "Verbal", memory: "Memory", pattern: "Pattern" },
    correct_msg: "‚úÖ Correct answer!",
    wrong_prefix: "‚ùå Wrong. Correct answer:",
    next: "NEXT ‚Üí",
    result_title: "Your Result",
    correct_label: "Correct",
    time_label: "Avg. Time",
    score_label: "Score",
    bd_title: "By Category",
    retry: "üîÑ Retry",
    share: "üì§ Share",
    iq_levels: [
      { min: 0, max: 70, label: "Low Level", desc: "Can be improved through practice and learning.", color: "#ff6584" },
      { min: 70, max: 90, label: "Below Average", desc: "Some areas need additional practice.", color: "#ffa500" },
      { min: 90, max: 110, label: "Average Level", desc: "Most people fall in this range.", color: "#ffd700" },
      { min: 110, max: 125, label: "Above Average", desc: "Your mental abilities are above average.", color: "#43e97b" },
      { min: 125, max: 140, label: "Gifted", desc: "You are among gifted individuals!", color: "#6c63ff" },
      { min: 140, max: 200, label: "Genius Level", desc: "Phenomenal intellectual ability! You're a genius!", color: "#ff6584" }
    ],
    combo: ["AMAZING! +", "GENIUS! +", "PHENOMENAL! +"],
    timeout: "Time's up!",
    share_text: (iq, score) => `I scored ${iq} IQ in IQ Test Pro! Score: ${score}. Try it yourself!`
  }
};

// ==================== QUESTIONS ====================
const allQuestions = [
  // LOGIC
  { cat: "logic", diff: 1, q: { uz: "Agar barcha mushuklar hayvon bo'lsa va ba'zi hayvonlar uy hayvoni bo'lsa, quyidagilardan qaysi biri albatta to'g'ri?", ru: "–ï—Å–ª–∏ –≤—Å–µ –∫–æ—à–∫–∏ ‚Äî –∂–∏–≤–æ—Ç–Ω—ã–µ, –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∂–∏–≤–æ—Ç–Ω—ã–µ ‚Äî –¥–æ–º–∞—à–Ω–∏–µ –ø–∏—Ç–æ–º—Ü—ã, —á—Ç–æ –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–Ω–æ?", en: "If all cats are animals and some animals are pets, which of the following must be true?" }, opts: { uz: ["Barcha mushuklar uy hayvoni", "Ba'zi mushuklar uy hayvoni bo'lishi mumkin", "Hech bir mushuk uy hayvoni emas", "Barcha hayvonlar mushuk"], ru: ["–í—Å–µ –∫–æ—à–∫–∏ ‚Äî –¥–æ–º–∞—à–Ω–∏–µ –ø–∏—Ç–æ–º—Ü—ã", "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ—à–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–∏—Ç–æ–º—Ü–∞–º–∏", "–ù–∏ –æ–¥–Ω–∞ –∫–æ—à–∫–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–∏—Ç–æ–º—Ü–µ–º", "–í—Å–µ –∂–∏–≤–æ—Ç–Ω—ã–µ ‚Äî –∫–æ—à–∫–∏"], en: ["All cats are pets", "Some cats may be pets", "No cat is a pet", "All animals are cats"] }, ans: 1, exp: { uz: "Mantiqan, ba'zi mushuklar uy hayvoni bo'lishi mumkin, lekin bu albatta bo'lishi shart emas.", ru: "–õ–æ–≥–∏—á–µ—Å–∫–∏, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ—à–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–∏—Ç–æ–º—Ü–∞–º–∏, –Ω–æ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.", en: "Logically, some cats may be pets but it's not necessarily guaranteed." } },
  { cat: "logic", diff: 2, q: { uz: "5 ta quti bor, ulardan biri oltin tutadi. Agar 1,2,3-qutilarda oltin yo'q bo'lsa, oltin qayerda?", ru: "–ï—Å—Ç—å 5 —è—â–∏–∫–æ–≤, –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–æ–ª–æ—Ç–æ. –ï—Å–ª–∏ –≤ —è—â–∏–∫–∞—Ö 1,2,3 –∑–æ–ª–æ—Ç–∞ –Ω–µ—Ç, –≥–¥–µ –∑–æ–ª–æ—Ç–æ?", en: "There are 5 boxes, one contains gold. If boxes 1,2,3 have no gold, where is the gold?" }, opts: { uz: ["4 yoki 5-qutida", "1-qutida", "Barcha qutilar bo'sh", "2-qutida"], ru: ["–í —è—â–∏–∫–µ 4 –∏–ª–∏ 5", "–í —è—â–∏–∫–µ 1", "–í—Å–µ —è—â–∏–∫–∏ –ø—É—Å—Ç—ã", "–í —è—â–∏–∫–µ 2"], en: ["In box 4 or 5", "In box 1", "All boxes are empty", "In box 2"] }, ans: 0, exp: { uz: "1,2,3 bo'sh bo'lsa, oltin 4 yoki 5-qutida bo'lishi kerak.", ru: "–ï—Å–ª–∏ 1,2,3 –ø—É—Å—Ç—ã, –∑–æ–ª–æ—Ç–æ –≤ —è—â–∏–∫–µ 4 –∏–ª–∏ 5.", en: "If 1,2,3 are empty, gold must be in box 4 or 5." } },
  { cat: "logic", diff: 3, q: { uz: "Ahmoqlar doimo noto'g'ri qaror qiladi. Ali doimo to'g'ri qaror qiladi. Bu nima anglatadi?", ru: "–î—É—Ä–∞–∫–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. –ê–ª–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. –ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç?", en: "Fools always make wrong decisions. Ali always makes right decisions. What does this imply?" }, opts: { uz: ["Ali ahmoq emas", "Ali ba'zan ahmoq", "Barcha ahmoqlar Ali", "Hech narsa"], ru: ["–ê–ª–∏ –Ω–µ –¥—É—Ä–∞–∫", "–ê–ª–∏ –∏–Ω–æ–≥–¥–∞ –¥—É—Ä–∞–∫", "–í—Å–µ –¥—É—Ä–∞–∫–∏ ‚Äî –ê–ª–∏", "–ù–∏—á–µ–≥–æ"], en: ["Ali is not a fool", "Ali is sometimes a fool", "All fools are Ali", "Nothing"] }, ans: 0, exp: { uz: "Ahmoqlar yomon qaror qilsa, Ali yaxshi qaror qiladi, demak Ali ahmoq emas.", ru: "–ï—Å–ª–∏ –¥—É—Ä–∞–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∞ –ê–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ‚Äî –ê–ª–∏ –Ω–µ –¥—É—Ä–∞–∫.", en: "If fools make wrong decisions and Ali makes right ones, Ali is not a fool." } },
  { cat: "logic", diff: 2, q: { uz: "Bir mashina 60 km/s tezlikda ketadi. 2 soatda qancha masofani bosib o'tadi?", ru: "–ú–∞—à–∏–Ω–∞ –µ–¥–µ—Ç —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é 60 –∫–º/—á. –ö–∞–∫–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ–Ω–∞ –ø—Ä–µ–æ–¥–æ–ª–µ–µ—Ç –∑–∞ 2 —á–∞—Å–∞?", en: "A car travels at 60 km/h. How far does it travel in 2 hours?" }, opts: { uz: ["120 km", "60 km", "30 km", "180 km"], ru: ["120 –∫–º", "60 –∫–º", "30 –∫–º", "180 –∫–º"], en: ["120 km", "60 km", "30 km", "180 km"] }, ans: 0, exp: { uz: "Masofa = tezlik √ó vaqt = 60 √ó 2 = 120 km", ru: "–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ = —Å–∫–æ—Ä–æ—Å—Ç—å √ó –≤—Ä–µ–º—è = 60 √ó 2 = 120 –∫–º", en: "Distance = speed √ó time = 60 √ó 2 = 120 km" } },

  // MATH (number sequences)
  { cat: "math", diff: 2, type: "sequence", q: { uz: "Quyidagi qatorning keyingi sonini toping:", ru: "–ù–∞–π–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ —á–∏—Å–ª–æ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:", en: "Find the next number in the sequence:" }, sequence: [2, 4, 8, 16, '?'], seqType: 'nums', opts: { uz: ["32", "20", "24", "18"], ru: ["32", "20", "24", "18"], en: ["32", "20", "24", "18"] }, ans: 0, exp: { uz: "Har bir son 2 ga ko'paytiriladi: 2√ó2=4, 4√ó2=8, 8√ó2=16, 16√ó2=32", ru: "–ö–∞–∂–¥–æ–µ —á–∏—Å–ª–æ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ 2: 2√ó2=4, 4√ó2=8, 8√ó2=16, 16√ó2=32", en: "Each number multiplies by 2: 2√ó2=4, 4√ó2=8, 8√ó2=16, 16√ó2=32" } },
  { cat: "math", diff: 2, type: "sequence", q: { uz: "Qatorning keyingi sonini toping:", ru: "–ù–∞–π–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ —á–∏—Å–ª–æ:", en: "Find the next number:" }, sequence: [1, 1, 2, 3, 5, 8, '?'], seqType: 'nums', opts: { uz: ["13", "11", "16", "10"], ru: ["13", "11", "16", "10"], en: ["13", "11", "16", "10"] }, ans: 0, exp: { uz: "Fibonacci: har son avvalgi ikkitasining yig'indisi. 5+8=13", ru: "–§–∏–±–æ–Ω–∞—á—á–∏: –∫–∞–∂–¥–æ–µ —á–∏—Å–ª–æ ‚Äî —Å—É–º–º–∞ –¥–≤—É—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö. 5+8=13", en: "Fibonacci: each number is sum of two previous. 5+8=13" } },
  { cat: "math", diff: 3, type: "sequence", q: { uz: "Keyingi son nima?", ru: "–ö–∞–∫–æ–µ —Å–ª–µ–¥—É—é—â–µ–µ —á–∏—Å–ª–æ?", en: "What is the next number?" }, sequence: [100, 81, 64, 49, '?'], seqType: 'nums', opts: { uz: ["36", "40", "35", "30"], ru: ["36", "40", "35", "30"], en: ["36", "40", "35", "30"] }, ans: 0, exp: { uz: "10¬≤, 9¬≤, 8¬≤, 7¬≤, 6¬≤ = 36. Sonlar kvadratlari kamayib boradi.", ru: "10¬≤, 9¬≤, 8¬≤, 7¬≤, 6¬≤ = 36. –ö–≤–∞–¥—Ä–∞—Ç—ã —á–∏—Å–µ–ª —É–±—ã–≤–∞—é—Ç.", en: "10¬≤, 9¬≤, 8¬≤, 7¬≤, 6¬≤ = 36. Squares of decreasing numbers." } },
  { cat: "math", diff: 1, q: { uz: "Qaysi son qatorga tegishli emas? 2, 3, 5, 7, 9, 11", ru: "–ö–∞–∫–æ–µ —á–∏—Å–ª–æ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ä—è–¥—É? 2, 3, 5, 7, 9, 11", en: "Which number doesn't belong? 2, 3, 5, 7, 9, 11" }, opts: { uz: ["9", "2", "5", "11"], ru: ["9", "2", "5", "11"], en: ["9", "2", "5", "11"] }, ans: 0, exp: { uz: "9 = 3√ó3, murakkab son. Qolganlari tub sonlar.", ru: "9 = 3√ó3, —Å–æ—Å—Ç–∞–≤–Ω–æ–µ —á–∏—Å–ª–æ. –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –ø—Ä–æ—Å—Ç—ã–µ.", en: "9 = 3√ó3, composite. Rest are prime numbers." } },
  { cat: "math", diff: 3, type: "math_expr", q: { uz: "Hisoblang:", ru: "–í—ã—á–∏—Å–ª–∏—Ç–µ:", en: "Calculate:" }, expr: "‚àö(144) + 3¬≤ = ?", opts: { uz: ["21", "19", "24", "18"], ru: ["21", "19", "24", "18"], en: ["21", "21", "24", "18"] }, ans: 0, exp: { uz: "‚àö144 = 12, 3¬≤ = 9, 12 + 9 = 21", ru: "‚àö144 = 12, 3¬≤ = 9, 12 + 9 = 21", en: "‚àö144 = 12, 3¬≤ = 9, 12 + 9 = 21" } },
  { cat: "math", diff: 2, type: "math_expr", q: { uz: "Topish:", ru: "–ù–∞–π—Ç–∏:", en: "Find:" }, expr: "15% of 200 = ?", opts: { uz: ["30", "25", "35", "20"], ru: ["30", "25", "35", "20"], en: ["30", "25", "35", "20"] }, ans: 0, exp: { uz: "200 √ó 15/100 = 30", ru: "200 √ó 15/100 = 30", en: "200 √ó 15/100 = 30" } },

  // PATTERN
  { cat: "pattern", diff: 2, type: "emoji-pattern", q: { uz: "Naqshda nima kelishi kerak?", ru: "–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ø–∞—Ç—Ç–µ—Ä–Ω–µ?", en: "What completes the pattern?" }, pattern: ['üî¥','üîµ','üü¢','üî¥','üîµ','?'], opts: { uz: ["üü¢", "üî¥", "üîµ", "üü°"], ru: ["üü¢", "üî¥", "üîµ", "üü°"], en: ["üü¢", "üî¥", "üîµ", "üü°"] }, ans: 0, exp: { uz: "Naqsh: üî¥üîµüü¢ takrorlanadi. Keyingisi üü¢.", ru: "–ü–∞—Ç—Ç–µ—Ä–Ω: üî¥üîµüü¢ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è. –°–ª–µ–¥—É—é—â–∏–π ‚Äî üü¢.", en: "Pattern: üî¥üîµüü¢ repeats. Next is üü¢." } },
  { cat: "pattern", diff: 3, type: "emoji-pattern", q: { uz: "Naqshni davom ettiring:", ru: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω:", en: "Continue the pattern:" }, pattern: ['‚≠ê','‚≠ê‚≠ê','‚≠ê','‚≠ê‚≠ê‚≠ê','‚≠ê','?'], opts: { uz: ["‚≠ê‚≠ê‚≠ê‚≠ê", "‚≠ê‚≠ê", "‚≠ê‚≠ê‚≠ê", "‚≠ê"], ru: ["‚≠ê‚≠ê‚≠ê‚≠ê", "‚≠ê‚≠ê", "‚≠ê‚≠ê‚≠ê", "‚≠ê"], en: ["‚≠ê‚≠ê‚≠ê‚≠ê", "‚≠ê‚≠ê", "‚≠ê‚≠ê‚≠ê", "‚≠ê"] }, ans: 0, exp: { uz: "1,2,1,3,1,4 ‚Äî har juft pozitsiyada oshib boradi.", ru: "1,2,1,3,1,4 ‚Äî –∫–∞–∂–¥–∞—è —á—ë—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è.", en: "1,2,1,3,1,4 ‚Äî alternating count increases." } },
  { cat: "pattern", diff: 1, type: "emoji-pattern", q: { uz: "Qatorning keyingi elementi nima?", ru: "–ß—Ç–æ —Å–ª–µ–¥—É—é—â–µ–µ –≤ —Ä—è–¥—É?", en: "What's next in the row?" }, pattern: ['üåô','üåô','‚òÄÔ∏è','üåô','üåô','‚òÄÔ∏è','üåô','üåô','?'], opts: { uz: ["‚òÄÔ∏è", "üåô", "‚≠ê", "üåü"], ru: ["‚òÄÔ∏è", "üåô", "‚≠ê", "üåü"], en: ["‚òÄÔ∏è", "üåô", "‚≠ê", "üåü"] }, ans: 0, exp: { uz: "Naqsh: üåôüåô‚òÄÔ∏è takrorlanadi. 9-element ‚òÄÔ∏è.", ru: "–ü–∞—Ç—Ç–µ—Ä–Ω: üåôüåô‚òÄÔ∏è –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è. 9-–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî ‚òÄÔ∏è.", en: "Pattern: üåôüåô‚òÄÔ∏è repeats. 9th element is ‚òÄÔ∏è." } },

  // SPATIAL
  { cat: "spatial", diff: 2, q: { uz: "Bir kub qo'lingizda bo'lsa, uning nechta tomoni bor?", ru: "–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫—É–±, —Å–∫–æ–ª—å–∫–æ —É –Ω–µ–≥–æ –≥—Ä–∞–Ω–µ–π?", en: "If you have a cube, how many faces does it have?" }, opts: { uz: ["6", "4", "8", "12"], ru: ["6", "4", "8", "12"], en: ["6", "4", "8", "12"] }, ans: 0, exp: { uz: "Kubning 6 ta tomoni bor: old, orqa, yon, yon, tepa, pastki.", ru: "–£ –∫—É–±–∞ 6 –≥—Ä–∞–Ω–µ–π: –ø–µ—Ä–µ–¥–Ω—è—è, –∑–∞–¥–Ω—è—è, –ª–µ–≤–∞—è, –ø—Ä–∞–≤–∞—è, –≤–µ—Ä—Ö–Ω—è—è, –Ω–∏–∂–Ω—è—è.", en: "A cube has 6 faces: front, back, left, right, top, bottom." } },
  { cat: "spatial", diff: 3, q: { uz: "Siz shimolga qarab tursangiz, o'ngga bursangiz, so'ng yana o'ngga bursangiz ‚Äî qaysi tomonga qarayapsiz?", ru: "–ï—Å–ª–∏ –≤—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å–µ–≤–µ—Ä, –ø–æ–≤–µ—Ä–Ω—ë—Ç–µ –≤–ø—Ä–∞–≤–æ, –∑–∞—Ç–µ–º –µ—â—ë —Ä–∞–∑ –≤–ø—Ä–∞–≤–æ ‚Äî –∫—É–¥–∞ –≤—ã —Å–º–æ—Ç—Ä–∏—Ç–µ?", en: "If you face north, turn right, then turn right again ‚Äî which direction do you face?" }, opts: { uz: ["Janubga", "Shimolga", "Sharqqa", "G'arbga"], ru: ["–ù–∞ —é–≥", "–ù–∞ —Å–µ–≤–µ—Ä", "–ù–∞ –≤–æ—Å—Ç–æ–∫", "–ù–∞ –∑–∞–ø–∞–¥"], en: ["South", "North", "East", "West"] }, ans: 0, exp: { uz: "Shimol ‚Üí Sharq (o'ngga) ‚Üí Janub (yana o'ngga).", ru: "–°–µ–≤–µ—Ä ‚Üí –í–æ—Å—Ç–æ–∫ (–ø—Ä–∞–≤—ã–π) ‚Üí –Æ–≥ (–µ—â—ë –ø—Ä–∞–≤—ã–π).", en: "North ‚Üí East (right) ‚Üí South (right again)." } },
  { cat: "spatial", diff: 2, q: { uz: "Aylana, uchburchak va kvadrat ichida nechta burchak bor jami?", ru: "–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —É–≥–ª–æ–≤ —É –∫—Ä—É–≥–∞, —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ –∏ –∫–≤–∞–¥—Ä–∞—Ç–∞?", en: "How many total corners do a circle, triangle and square have?" }, opts: { uz: ["7", "6", "8", "9"], ru: ["7", "6", "8", "9"], en: ["7", "6", "8", "9"] }, ans: 0, exp: { uz: "Aylana 0 + Uchburchak 3 + Kvadrat 4 = 7", ru: "–ö—Ä—É–≥ 0 + –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ 3 + –ö–≤–∞–¥—Ä–∞—Ç 4 = 7", en: "Circle 0 + Triangle 3 + Square 4 = 7" } },
  { cat: "spatial", diff: 3, q: { uz: "5√ó5 kvadrat katakdan iborat jadvalda, diagonal bo'ylab nechta katak bor?", ru: "–í —Å–µ—Ç–∫–µ 5√ó5 —Å–∫–æ–ª—å–∫–æ –∫–ª–µ—Ç–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≥–ª–∞–≤–Ω–æ–π –¥–∏–∞–≥–æ–Ω–∞–ª–∏?", en: "In a 5√ó5 grid, how many cells are on the main diagonal?" }, opts: { uz: ["5", "10", "7", "9"], ru: ["5", "10", "7", "9"], en: ["5", "10", "7", "9"] }, ans: 0, exp: { uz: "n√ón kvadratning diagonal uzunligi n ta. 5√ó5 ‚Üí 5 katak.", ru: "–î–∏–∞–≥–æ–Ω–∞–ª—å n√ón —Å–µ—Ç–∫–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç n –∫–ª–µ—Ç–æ–∫. 5√ó5 ‚Üí 5.", en: "Diagonal of n√ón grid has n cells. 5√ó5 ‚Üí 5 cells." } },

  // VERBAL
  { cat: "verbal", diff: 1, type: "analogy", q: { uz: "Analogiyani tugallang:", ru: "–ó–∞–≤–µ—Ä—à–∏—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—é:", en: "Complete the analogy:" }, analogy: { uz: ["Kitob", "O'qish", "Qalam", "?"], ru: ["–ö–Ω–∏–≥–∞", "–ß—Ç–µ–Ω–∏–µ", "–ö–∞—Ä–∞–Ω–¥–∞—à", "?"], en: ["Book", "Reading", "Pencil", "?"] }, opts: { uz: ["Yozish", "O'qish", "Rasm", "Chizish"], ru: ["–ü–∏—Å—å–º–æ", "–ß—Ç–µ–Ω–∏–µ", "–†–∏—Å—É–Ω–æ–∫", "–†–∏—Å–æ–≤–∞–Ω–∏–µ"], en: ["Writing", "Reading", "Drawing", "Painting"] }, ans: 0, exp: { uz: "Kitob ‚Üí o'qish uchun. Qalam ‚Üí yozish uchun.", ru: "–ö–Ω–∏–≥–∞ ‚Üí –¥–ª—è —á—Ç–µ–Ω–∏—è. –ö–∞—Ä–∞–Ω–¥–∞—à ‚Üí –¥–ª—è –ø–∏—Å—å–º–∞.", en: "Book is for reading. Pencil is for writing." } },
  { cat: "verbal", diff: 2, type: "analogy", q: { uz: "Analogiyani davom ettiring:", ru: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—é:", en: "Continue the analogy:" }, analogy: { uz: ["Baliq", "Suv", "Qush", "?"], ru: ["–†—ã–±–∞", "–í–æ–¥–∞", "–ü—Ç–∏—Ü–∞", "?"], en: ["Fish", "Water", "Bird", "?"] }, opts: { uz: ["Havo", "Yer", "Daryo", "O'rmon"], ru: ["–í–æ–∑–¥—É—Ö", "–ó–µ–º–ª—è", "–†–µ–∫–∞", "–õ–µ—Å"], en: ["Air", "Ground", "River", "Forest"] }, ans: 0, exp: { uz: "Baliq suvda yashayd√≠. Qush havoda uchadi.", ru: "–†—ã–±–∞ –∂–∏–≤—ë—Ç –≤ –≤–æ–¥–µ. –ü—Ç–∏—Ü–∞ –ª–µ—Ç–∞–µ—Ç –≤ –≤–æ–∑–¥—É—Ö–µ.", en: "Fish lives in water. Bird flies in air." } },
  { cat: "verbal", diff: 2, q: { uz: "Qaysi so'z boshqalaridan farq qiladi?", ru: "–ö–∞–∫–æ–µ —Å–ª–æ–≤–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö?", en: "Which word is different from the others?" }, opts: { uz: ["Olma", "Shaftoli", "Sabzi", "Gilos"], ru: ["–Ø–±–ª–æ–∫–æ", "–ü–µ—Ä—Å–∏–∫", "–ú–æ—Ä–∫–æ–≤—å", "–í–∏—à–Ω—è"], en: ["Apple", "Peach", "Carrot", "Cherry"] }, ans: 2, exp: { uz: "Sabzi sabzavot, qolganlari meva.", ru: "–ú–æ—Ä–∫–æ–≤—å ‚Äî –æ–≤–æ—â, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî —Ñ—Ä—É–∫—Ç—ã.", en: "Carrot is a vegetable, others are fruits." } },
  { cat: "verbal", diff: 3, type: "analogy", q: { uz: "To'ldiring:", ru: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ:", en: "Fill in:" }, analogy: { uz: ["Shoir", "She'r", "Muhandis", "?"], ru: ["–ü–æ—ç—Ç", "–ü–æ—ç–∑–∏—è", "–ò–Ω–∂–µ–Ω–µ—Ä", "?"], en: ["Poet", "Poetry", "Engineer", "?"] }, opts: { uz: ["Loyiha", "Kitob", "Rasm", "Bino"], ru: ["–ü—Ä–æ–µ–∫—Ç", "–ö–Ω–∏–≥–∞", "–†–∏—Å—É–Ω–æ–∫", "–ó–¥–∞–Ω–∏–µ"], en: ["Project", "Book", "Drawing", "Building"] }, ans: 0, exp: { uz: "Shoir she'r yozadi. Muhandis loyiha tuzadi.", ru: "–ü–æ—ç—Ç –ø–∏—à–µ—Ç –ø–æ—ç–∑–∏—é. –ò–Ω–∂–µ–Ω–µ—Ä —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–µ–∫—Ç.", en: "Poet writes poetry. Engineer creates a project." } },

  // MEMORY / SEQUENCE
  { cat: "memory", diff: 2, type: "sequence", q: { uz: "Quyidagi qatorni o'rganing va keyingi raqamni toping:", ru: "–ò–∑—É—á–∏—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–π–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç:", en: "Study the sequence and find the next number:" }, sequence: [3, 6, 12, 24, '?'], seqType: 'nums', opts: { uz: ["48", "36", "42", "30"], ru: ["48", "36", "42", "30"], en: ["48", "36", "42", "30"] }, ans: 0, exp: { uz: "Har son 2 ga ko'paytiriladi. 24√ó2=48", ru: "–ö–∞–∂–¥–æ–µ —á–∏—Å–ª–æ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ 2. 24√ó2=48", en: "Each number multiplied by 2. 24√ó2=48" } },
  { cat: "memory", diff: 1, type: "sequence", q: { uz: "Quyidagi ketma-ketlikni davom ettiring:", ru: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:", en: "Continue the sequence:" }, sequence: [5, 10, 15, 20, '?'], seqType: 'nums', opts: { uz: ["25", "22", "30", "20"], ru: ["25", "22", "30", "20"], en: ["25", "22", "30", "20"] }, ans: 0, exp: { uz: "Har son 5 ga oshadi. 20+5=25", ru: "–ö–∞–∂–¥–æ–µ —á–∏—Å–ª–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 5. 20+5=25", en: "Each number increases by 5. 20+5=25" } },
  { cat: "memory", diff: 3, type: "sequence", q: { uz: "Bu qatorda naqsh nima? Keyingisini toping:", ru: "–ß—Ç–æ –∑–∞ –ø–∞—Ç—Ç–µ—Ä–Ω? –ù–∞–π–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ:", en: "What's the pattern? Find the next:" }, sequence: [1, 4, 9, 16, 25, '?'], seqType: 'nums', opts: { uz: ["36", "30", "32", "35"], ru: ["36", "30", "32", "35"], en: ["36", "30", "32", "35"] }, ans: 0, exp: { uz: "1¬≤, 2¬≤, 3¬≤, 4¬≤, 5¬≤, 6¬≤ = 36. To'liq kvadratlar.", ru: "1¬≤, 2¬≤, 3¬≤, 4¬≤, 5¬≤, 6¬≤ = 36. –ü–æ–ª–Ω—ã–µ –∫–≤–∞–¥—Ä–∞—Ç—ã.", en: "1¬≤, 2¬≤, 3¬≤, 4¬≤, 5¬≤, 6¬≤ = 36. Perfect squares." } },
  { cat: "memory", diff: 2, q: { uz: "Savol: Nechta yil bir asrda bor?", ru: "–í–æ–ø—Ä–æ—Å: –°–∫–æ–ª—å–∫–æ –ª–µ—Ç –≤ –æ–¥–Ω–æ–º –≤–µ–∫–µ?", en: "Question: How many years are in a century?" }, opts: { uz: ["100", "1000", "10", "50"], ru: ["100", "1000", "10", "50"], en: ["100", "1000", "10", "50"] }, ans: 0, exp: { uz: "1 asr = 100 yil", ru: "1 –≤–µ–∫ = 100 –ª–µ—Ç", en: "1 century = 100 years" } }
];

// ==================== GAME STATE ====================
let currentLang = 'en';
let gameQuestions = [];
let currentQ = 0;
let score = 0;
let timerInterval = null;
let timeLeft = 30;
let answered = false;
let combo = 0;
let totalTime = 0;
let qStartTime = 0;
let categoryScores = {};
let categoryTotal = {};
let prevScreen = null;

// ==================== FLOW ====================
function selectLang(l) {
  playSound('click');
  initAudio();
  currentLang = l;
  showScreen('intro-screen');
  updateIntroText();
}

function updateIntroText() {
  const t = lang[currentLang];
  document.getElementById('intro-desc').textContent = t.intro_desc;
  document.getElementById('stat-q').textContent = t.stat_q;
  document.getElementById('stat-t').textContent = t.stat_t;
  document.getElementById('stat-c').textContent = t.stat_c;
  document.getElementById('startBtn').textContent = t.start;
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');

  const backBtn = document.getElementById('backBtn');
  if (id === 'intro-screen') { backBtn.classList.add('show'); }
  else { backBtn.classList.remove('show'); }
}

function goBack() {
  playSound('click');
  if (document.getElementById('game-screen').classList.contains('active')) {
    clearInterval(timerInterval);
    showScreen('intro-screen');
  } else {
    showScreen('lang-screen');
  }
}

function startGame() {
  playSound('click');
  // Shuffle and select 25 questions
  let shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
  gameQuestions = shuffled.slice(0, Math.min(25, shuffled.length));
  // Ensure we have at least something
  while (gameQuestions.length < 10) {
    gameQuestions = [...gameQuestions, ...shuffled].slice(0, 25);
  }

  currentQ = 0;
  score = 0;
  combo = 0;
  totalTime = 0;
  categoryScores = {};
  categoryTotal = {};
  showScreen('game-screen');
  renderQuestion();
}

function renderQuestion() {
  const t = lang[currentLang];
  const q = gameQuestions[currentQ];
  answered = false;
  timeLeft = 30;
  qStartTime = Date.now();

  // Update category stats
  if (!categoryTotal[q.cat]) { categoryTotal[q.cat] = 0; categoryScores[q.cat] = 0; }
  categoryTotal[q.cat]++;

  // Header
  document.getElementById('progressInfo').textContent = `Q ${currentQ + 1} / ${gameQuestions.length}`;
  document.getElementById('scoreBox').textContent = `‚≠ê ${score}`;
  document.getElementById('progressBar').style.width = `${(currentQ / gameQuestions.length) * 100}%`;
  document.getElementById('categoryBadge').textContent = t.categories[q.cat] || q.cat;
  document.getElementById('qNum').textContent = `Q${currentQ + 1}`;

  // Difficulty dots
  const diffBar = document.getElementById('diffBar');
  diffBar.innerHTML = '';
  for (let i = 1; i <= 3; i++) {
    const d = document.createElement('div');
    d.className = 'diff-dot' + (i <= q.diff ? ' filled' : '');
    diffBar.appendChild(d);
  }

  // Timer
  document.getElementById('timerVal').textContent = timeLeft;
  document.getElementById('timerVal').classList.remove('urgent');
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    timeLeft--;
    const tv = document.getElementById('timerVal');
    tv.textContent = timeLeft;
    if (timeLeft <= 10) { tv.classList.add('urgent'); if (timeLeft > 0) playSound('tick'); }
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      timeoutQ();
    }
  }, 1000);

  // Question text
  document.getElementById('questionText').textContent = q.q[currentLang] || q.q.en;

  // Visual
  const visual = document.getElementById('questionVisual');
  visual.innerHTML = '';

  if (q.type === 'sequence' && q.seqType === 'nums') {
    const row = document.createElement('div');
    row.className = 'sequence-row';
    q.sequence.forEach((s, i) => {
      if (i > 0) {
        const arr = document.createElement('span');
        arr.className = 'seq-arrow';
        arr.textContent = '‚Üí';
        row.appendChild(arr);
      }
      const item = document.createElement('div');
      item.className = 'seq-item' + (s === '?' ? ' unknown' : '');
      item.textContent = s === '?' ? '?' : s;
      row.appendChild(item);
    });
    visual.appendChild(row);
  } else if (q.type === 'emoji-pattern') {
    const row = document.createElement('div');
    row.className = 'sequence-row';
    row.style.flexWrap = 'wrap';
    q.pattern.forEach(s => {
      const item = document.createElement('div');
      item.className = 'seq-item' + (s === '?' ? ' unknown' : '');
      item.style.fontSize = '1.5rem';
      item.textContent = s;
      row.appendChild(item);
    });
    visual.appendChild(row);
  } else if (q.type === 'analogy') {
    const row = document.createElement('div');
    row.className = 'analogy-display';
    const words = q.analogy[currentLang] || q.analogy.en;
    words.forEach((w, i) => {
      if (i === 1 || i === 3) {
        const arr = document.createElement('span');
        arr.className = 'analogy-arrow';
        arr.textContent = i === 1 ? '‚Üí' : '';
        if (i === 1) row.appendChild(arr);
      }
      if (i === 2) {
        const sep = document.createElement('span');
        sep.className = 'analogy-arrow';
        sep.textContent = '|';
        sep.style.margin = '0 10px';
        row.appendChild(sep);
      }
      const word = document.createElement('div');
      word.className = 'analogy-word' + (w === '?' ? ' unknown' : '');
      word.textContent = w === '?' ? '?' : w;
      row.appendChild(word);
      if (i === 0) {
        // arrow already added
      }
      if (i === 2) {
        const arr2 = document.createElement('span');
        arr2.className = 'analogy-arrow';
        arr2.textContent = '‚Üí';
        row.appendChild(arr2);
      }
    });
    visual.appendChild(row);
  } else if (q.type === 'math_expr') {
    const math = document.createElement('div');
    math.className = 'math-display';
    math.textContent = q.expr;
    visual.appendChild(math);
  }

  // Options
  const grid = document.getElementById('optionsGrid');
  grid.innerHTML = '';
  const opts = q.opts[currentLang] || q.opts.en;
  const labels = ['A', 'B', 'C', 'D'];

  opts.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.innerHTML = `
      <div class="opt-label">${labels[i]}</div>
      <div class="opt-text">${opt}</div>
      <span class="checkmark">‚úÖ</span>
      <span class="xmark">‚ùå</span>`;
    btn.onclick = () => answerQ(i, btn);
    grid.appendChild(btn);
  });

  // Feedback + next
  document.getElementById('feedbackBubble').className = 'feedback-bubble';
  document.getElementById('feedbackBubble').textContent = '';
  document.getElementById('nextBtn').className = 'next-btn';
  document.getElementById('nextBtn').textContent = t.next;

  // Reset card animation
  const card = document.getElementById('questionCard');
  card.style.animation = 'none';
  card.offsetHeight;
  card.style.animation = 'slideIn 0.4s ease';
}

function answerQ(selected, btn) {
  if (answered) return;
  answered = true;
  clearInterval(timerInterval);

  const q = gameQuestions[currentQ];
  const t = lang[currentLang];
  const elapsed = (Date.now() - qStartTime) / 1000;
  totalTime += elapsed;

  const btns = document.querySelectorAll('.option-btn');
  btns.forEach(b => b.disabled = true);

  const opts = q.opts[currentLang] || q.opts.en;
  const fb = document.getElementById('feedbackBubble');

  if (selected === q.ans) {
    btn.classList.add('correct');
    combo++;
    const points = Math.max(10, 30 - Math.floor(elapsed));
    score += points;
    if (!categoryScores[q.cat]) categoryScores[q.cat] = 0;
    categoryScores[q.cat]++;
    playSound('correct');
    fb.className = 'feedback-bubble correct-fb';
    fb.textContent = `${t.correct_msg} (+${points} pts) ${q.exp[currentLang] || q.exp.en}`;

    if (combo >= 3) {
      playSound('combo');
      showCombo(combo, t);
    }

    // Highlight correct
    btns[q.ans].classList.add('correct');
  } else {
    btn.classList.add('wrong');
    combo = 0;
    playSound('wrong');
    btns[q.ans].classList.add('correct');
    fb.className = 'feedback-bubble wrong-fb';
    fb.textContent = `${t.wrong_prefix} ${opts[q.ans]}. ${q.exp[currentLang] || q.exp.en}`;
  }

  document.getElementById('scoreBox').textContent = `‚≠ê ${score}`;
  document.getElementById('nextBtn').classList.add('show');
}

function timeoutQ() {
  if (answered) return;
  answered = true;
  combo = 0;
  const q = gameQuestions[currentQ];
  const t = lang[currentLang];
  const opts = q.opts[currentLang] || q.opts.en;

  document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
  document.querySelectorAll('.option-btn')[q.ans].classList.add('correct');

  const fb = document.getElementById('feedbackBubble');
  fb.className = 'feedback-bubble wrong-fb';
  fb.textContent = `‚è∞ ${t.timeout} ${t.wrong_prefix} ${opts[q.ans]}`;

  document.getElementById('nextBtn').classList.add('show');
  playSound('wrong');
}

function showCombo(count, t) {
  const popup = document.getElementById('comboPopup');
  const msgs = t.combo;
  popup.textContent = msgs[Math.min(msgs.length - 1, Math.floor((count - 3) / 2))] + count;
  popup.classList.remove('show');
  popup.offsetHeight;
  popup.classList.add('show');
  setTimeout(() => popup.classList.remove('show'), 1600);
}

function nextQuestion() {
  playSound('click');
  currentQ++;
  if (currentQ >= gameQuestions.length) {
    showResults();
  } else {
    renderQuestion();
  }
}

// ==================== RESULTS ====================
function showResults() {
  clearInterval(timerInterval);
  showScreen('result-screen');
  playSound('finish');
  const t = lang[currentLang];

  const correct = Object.values(categoryScores).reduce((a, b) => a + b, 0);
  const total = gameQuestions.length;
  const pct = correct / total;
  const avgTime = totalTime / total;

  // IQ calculation (85‚Äì145 range based on performance)
  const iq = Math.round(85 + pct * 60 + Math.max(0, (20 - avgTime) * 0.5));
  const clampedIQ = Math.max(70, Math.min(160, iq));

  // Animate IQ counter
  const iqEl = document.getElementById('iqVal');
  let count = 70;
  const interval = setInterval(() => {
    count += 2;
    if (count >= clampedIQ) { count = clampedIQ; clearInterval(interval); }
    iqEl.textContent = count;
  }, 30);

  // Circle progress
  const circlePct = ((clampedIQ - 70) / 90) * 100;
  document.getElementById('iqCircle').style.setProperty('--pct', `${circlePct}%`);

  // IQ level
  const level = t.iq_levels.find(l => clampedIQ >= l.min && clampedIQ < l.max) || t.iq_levels[t.iq_levels.length - 1];
  document.getElementById('iqCategory').textContent = level.label;
  document.getElementById('iqCategory').style.color = level.color;
  document.getElementById('iqDesc').textContent = level.desc;

  // Stats
  document.getElementById('resCorrect').textContent = `${correct}/${total}`;
  document.getElementById('resTime').textContent = `${avgTime.toFixed(1)}s`;
  document.getElementById('resScore').textContent = score;
  document.getElementById('resCorrectLabel').textContent = t.correct_label;
  document.getElementById('resTimeLabel').textContent = t.time_label;
  document.getElementById('resScoreLabel').textContent = t.score_label;
  document.getElementById('retryBtn').textContent = t.retry;
  document.getElementById('shareBtn').textContent = t.share;

  // Breakdown
  const bd = document.getElementById('scoreBreakdown');
  bd.innerHTML = `<div class="breakdown-title">${t.bd_title}</div>`;
  const colors = { logic: '#6c63ff', math: '#ff6584', spatial: '#43e97b', verbal: '#ffd700', memory: '#43b9e9', pattern: '#f97316' };
  Object.keys(categoryTotal).forEach(cat => {
    const sc = (categoryScores[cat] || 0);
    const tot = categoryTotal[cat];
    const p = tot > 0 ? (sc / tot * 100) : 0;
    const catLabel = t.categories[cat] || cat;
    const row = document.createElement('div');
    row.className = 'breakdown-row';
    row.innerHTML = `
      <div class="br-label">${catLabel}</div>
      <div class="br-bar-wrap"><div class="br-bar-fill" style="width:0%;background:${colors[cat] || '#6c63ff'}"></div></div>
      <div class="br-score">${sc}/${tot}</div>`;
    bd.appendChild(row);
    setTimeout(() => { row.querySelector('.br-bar-fill').style.width = p + '%'; }, 200);
  });

  // Confetti for high IQ
  if (clampedIQ >= 120) launchConfetti();
}

function launchConfetti() {
  const colors = ['#6c63ff', '#ff6584', '#43e97b', '#ffd700', '#ff8c00', '#00bcd4'];
  for (let i = 0; i < 80; i++) {
    setTimeout(() => {
      const c = document.createElement('div');
      c.className = 'confetti-piece';
      c.style.left = Math.random() * 100 + 'vw';
      c.style.background = colors[Math.floor(Math.random() * colors.length)];
      c.style.setProperty('--tx', (Math.random() - 0.5) * 200 + 'px');
      c.style.animationDuration = (Math.random() * 2 + 1.5) + 's';
      c.style.animationDelay = (Math.random() * 0.5) + 's';
      c.style.width = (Math.random() * 10 + 5) + 'px';
      c.style.height = (Math.random() * 10 + 5) + 'px';
      document.body.appendChild(c);
      setTimeout(() => c.remove(), 4000);
    }, i * 30);
  }
}

function retry() {
  playSound('click');
  showScreen('intro-screen');
}

function shareResult() {
  playSound('click');
  const iq = document.getElementById('iqVal').textContent;
  const t = lang[currentLang];
  const text = t.share_text(iq, score);
  if (navigator.share) {
    navigator.share({ title: 'IQ Test Pro', text });
  } else {
    navigator.clipboard.writeText(text).then(() => alert('Copied to clipboard!'));
  }
}
</script>
</body>
</html>
